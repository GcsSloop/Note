# 多终端同步倒计时

在一些活动中，例如秒杀活动，需要在 7:00 准时开始秒杀，在开始之前则需要给用户一个倒计时时间告诉用户还有多久活动才开始，此时的时间依据就很重要了，如果设计不合理，则可能导致各种问题。

### 1. 依赖客户端时间

假如用户自己把时间调快，则这部分用户就可以提前抢到商品，显然是不公平的。

### 2. 依赖服务器时间

服务器到客户端之间有延迟，网速快慢会显著影响开始时间。

### 3. 以服务器时间为主，开机时间为辅

1. 客户端发起请求时记录当前开机时间 start。
2. 服务器返回当前时刻 server_time。
3. 客户端收到请求后获取当前开机时刻 end。
4. time = server_time + (end - start)/2

> 这样设计是假设从访问服务器和返回结果花费的时间是一致的，虽然有些许误差，但总体上要比单纯依赖服务器时间要精确的多。
>
> 为什么要使用系统开机时间，而不使用系统当前的时间，这是因为系统开机时间不可更改，而系统当前时间可以更改，避免了一些作弊的可能性。
>
> 如果是使用系统当前的时间，而非开机时间，那就存在如下一种作弊可能性：
>
> 1. 网络接代理，可以进行网络阻塞挂起。
> 2. 发起请求后立即挂起网络，禁止向服务器发出请求。
> 3. 立马修改当前系统时间，将时间调后。
> 4. 取消挂起网络，让服务器正常返回结果。
> 5. 这样使用 end - start 的时间差就会很大，就可以提前进入活动。
>
> 因此不要使用系统时间，而是使用系统开机时间。